{% extends webapp_config['LAYOUT'] %}

{% block content %}
{% include "docs/_search-bar.html" %}
<div class="p-strip">
  <div class="row">
    <div class="col-3">
      <aside class="p-side-navigation--discourse" id="drawer">

        <button class="p-side-navigation__toggle js-drawer-toggle" aria-controls="drawer">
          Toggle side navigation
        </button>

        <div class="p-side-navigation__overlay js-drawer-toggle" aria-controls="drawer"></div>
        <nav class="p-side-navigation__drawer">
          <div class="p-side-navigation__drawer-header">
            <button class="p-side-navigation__toggle--in-drawer js-drawer-toggle" aria-controls="drawer">
              Toggle side navigation
            </button>
          </div>
          {{ navigation | safe }}
        </nav>
      </aside>
    </div>

    <div class="col-9">
      {% block content_docs %}{% endblock %}
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  window.addEventListener("DOMContentLoaded", function() {
    Raven.context(function() {
      const path = window.location.pathname;
      const active = document.querySelector(`.p-side-navigation--discourse a[href="${path}"]`);
      if (active) {
        active.classList.add("is-active");
      }


      /**
        Toggles the expanded/collapsed classed on side navigation element.

        @param {HTMLElement} sideNavigation The side navigation element.
        @param {Boolean} show Whether to show or hide the drawer.
      */
      function toggleDrawer(sideNavigation, show) {
        if (sideNavigation) {
          if (show) {
            sideNavigation.classList.remove('is-collapsed');
            sideNavigation.classList.add('is-expanded');
          } else {
            sideNavigation.classList.remove('is-expanded');
            sideNavigation.classList.add('is-collapsed');
          }
        }
      }

      /**
        Attaches event listeners for the side navigation toggles
        @param {HTMLElement} sideNavigation The side navigation element.
      */
      function setupSideNavigation(sideNavigation) {
        var toggles = [].slice.call(sideNavigation.querySelectorAll('.js-drawer-toggle'));

        toggles.forEach(function (toggle) {
          toggle.addEventListener('click', function (event) {
            event.preventDefault();
            var sideNav = document.getElementById(toggle.getAttribute('aria-controls'));

            if (sideNav) {
              toggleDrawer(sideNav, !sideNav.classList.contains('is-expanded'));
            }
          });
        });
      }

      setupSideNavigation(document.getElementById("drawer"));
      // const toggleSidebar = document.querySelector(".p-sidebar__toggle");
      // const sidebar = document.querySelector(".p-sidebar__content");
      // if (toggleSidebar) {
      //   toggleSidebar.addEventListener("click", function(e) {
      //     sidebar.classList.toggle("u-hide--small");
      //     toggleSidebar.classList.toggle("p-icon--close");
      //     toggleSidebar.classList.toggle("p-icon--menu");
      //   });
      // }
    });
  });
</script>
{% endblock %}
